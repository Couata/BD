SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";
SET NAMES utf8mb4;


CREATE DATABASE IF NOT EXISTS group7;
CREATE USER IF NOT EXISTS 'group7'@'%' IDENTIFIED BY 'agent007';
GRANT ALL PRIVILEGES ON group7.* TO 'group7'@'%';
FLUSH PRIVILEGES;
USE group7;

/* Script to create all tables of group07DB */

CREATE TABLE AGENCE (
    ID INT PRIMARY KEY,
    NOM VARCHAR(64) NOT NULL,
    URL VARCHAR(255) NOT NULL,
    FUSEAU_HORAIRE VARCHAR(64) NOT NULL,
    TELEPHONE VARCHAR(64) NOT NULL,
    SIEGE VARCHAR(128) NOT NULL
);

CREATE TABLE ARRET (
    ID INT PRIMARY KEY,
    NOM VARCHAR(64),
    LATITUDE FLOAT,
    LONGITUDE FLOAT
);

CREATE TABLE ITINERAIRE (
    ID INT PRIMARY KEY,
    AGENCE_ID INT NOT NULL,
    TYPE VARCHAR(64),
    NOM VARCHAR(64),
    FOREIGN KEY (AGENCE_ID) REFERENCES AGENCE(ID) ON DELETE CASCADE
);

CREATE TABLE SERVICE (
    ID INT PRIMARY KEY,
    NOM VARCHAR(64),
    LUNDI BOOLEAN,
    MARDI BOOLEAN,
    MERCREDI BOOLEAN,
    JEUDI BOOLEAN,
    VENDREDI BOOLEAN,
    SAMEDI BOOLEAN,
    DIMANCHE BOOLEAN,
    DATE_DEBUT DATE,
    DATE_FIN DATE
);

CREATE TABLE TRAJET (
    TRAJET_ID VARCHAR(64) PRIMARY KEY,
    SERVICE_ID INT NOT NULL,
    ITINERAIRE_ID INT NOT NULL,
    DIRECTION BOOLEAN,
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICE(ID) ON DELETE CASCADE,
    FOREIGN KEY (ITINERAIRE_ID) REFERENCES ITINERAIRE(ID) ON DELETE CASCADE
);

CREATE TABLE EXCEPTION_JOUR (
    SERVICE_ID INT NOT NULL,
    DATE_EXCEPTION DATE NOT NULL,
    CODE INT CHECK (CODE IN (1,2)),
    PRIMARY KEY (SERVICE_ID, DATE_EXCEPTION),
    FOREIGN KEY (SERVICE_ID) REFERENCES SERVICE(ID) ON DELETE CASCADE
);

CREATE TABLE HORRAIRE (
    TRAJET_ID VARCHAR(64) NOT NULL,
    ITINERAIRE_ID INT NOT NULL,
    ARRET_ID INT NOT NULL,
    HEURE_ARRIVEE TIME,
    HEURE_DEPART TIME,
    PRIMARY KEY (TRAJET_ID, ITINERAIRE_ID, ARRET_ID),
    FOREIGN KEY (TRAJET_ID) REFERENCES TRAJET(TRAJET_ID) ON DELETE CASCADE,
    FOREIGN KEY (ITINERAIRE_ID) REFERENCES ITINERAIRE(ID) ON DELETE CASCADE,
    FOREIGN KEY (ARRET_ID) REFERENCES ARRET(ID) ON DELETE CASCADE
);

CREATE TABLE LANGUEPRINCIPALE (
    AGENCE_ID INT NOT NULL,
    LANGUE VARCHAR(2) CHECK (CHAR_LENGTH(LANGUE) = 2),
    PRIMARY KEY (AGENCE_ID, LANGUE),
    FOREIGN KEY (AGENCE_ID) REFERENCES AGENCE(ID) ON DELETE CASCADE
);

CREATE TABLE ARRET_DESSERVI (
    ITINERAIRE_ID INT NOT NULL,
    ARRET_ID INT NOT NULL,
    SEQUENCE INT CHECK (SEQUENCE >= 1),
    PRIMARY KEY (ITINERAIRE_ID, ARRET_ID),
    FOREIGN KEY (ITINERAIRE_ID) REFERENCES ITINERAIRE(ID) ON DELETE CASCADE,
    FOREIGN KEY (ARRET_ID) REFERENCES ARRET(ID) ON DELETE CASCADE
);



